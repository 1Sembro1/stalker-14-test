- type: htnCompound
  id: BotStalkerZombie
  branches:
    - tasks:
        - !type:HTNCompoundTask
          task: RangedCombatCompoundBotStalkerZombie
    - tasks:
        - !type:HTNCompoundTask
          task: MeleeCombatCompoundBotStalkerZombie
    - tasks:
        - !type:HTNCompoundTask
          task: IdleCompoundBotStalkerZombie

- type: htnCompound
  id: IdleCompoundBotStalkerZombie
  branches:
    - tasks:
        - !type:HTNPrimitiveTask
          operator: !type:PickAccessibleOperator
            rangeKey: BufferRange
        - !type:HTNPrimitiveTask
          operator: !type:MoveToOperator
            pathfindInPlanning: false
        - !type:HTNPrimitiveTask
          operator: !type:RandomOperator
            targetKey: IdleTime
            minKey: MovementRangeClose
            maxKey: MinimumIdleTime
        - !type:HTNPrimitiveTask
          operator: !type:WaitOperator
            key: IdleTime
          preconditions:
            - !type:KeyExistsPrecondition
              key: IdleTime

- type: htnCompound
  id: PickupMeleeCompoundFix
  branches:
    - tasks:
        - !type:HTNPrimitiveTask
          operator: !type:UtilityOperator
            proto: NearbyMeleeWeapons
        - !type:HTNPrimitiveTask
          operator: !type:MoveToOperator
            pathfindInPlanning: true
        - !type:HTNPrimitiveTask
          preconditions:
            - !type:ActiveHandFreePrecondition
            - !type:TargetInRangePrecondition
              targetKey: Target
              rangeKey: InteractRange
          operator: !type:InteractWithOperator
            targetKey: Target


- type: htnCompound
  id: MeleeAttackTargetCompoundBotStalkerZombie
  preconditions:
    - !type:KeyExistsPrecondition
      key: Target
  branches:
    # Move to melee range and hit them
    - tasks:
        - !type:HTNPrimitiveTask
          operator: !type:MoveToOperator
            shutdownState: PlanFinished
            pathfindInPlanning: true
            removeKeyOnFinish: false
            targetKey: TargetCoordinates
            pathfindKey: TargetPathfind
            rangeKey: MeleeRange
        - !type:HTNPrimitiveTask
          operator: !type:JukeOperator
            jukeType: Away
        - !type:HTNPrimitiveTask
          operator: !type:MeleeOperator
            targetKey: Target
          preconditions:
            - !type:KeyExistsPrecondition
              key: Target
            - !type:TargetInRangePrecondition
              targetKey: Target
              rangeKey: MeleeRange
          services:
            - !type:UtilityService
              id: MeleeService
              proto: NearbyMeleeTargets
              key: Target

- type: htnCompound
  id: GunCombatCompoundBotStalkerZombie
  branches:
    # Pick target, then move into range and shoot them.
    - tasks:
        - !type:HTNPrimitiveTask
          operator: !type:UtilityOperator
            proto: NearbyGunTargets
        - !type:HTNPrimitiveTask
          operator: !type:MoveToOperator
            shutdownState: PlanFinished
            pathfindInPlanning: true
            removeKeyOnFinish: false
            targetKey: TargetCoordinates
            pathfindKey: TargetPathfind
            stopOnLineOfSight: true
            rangeKey: MeleeRange
        - !type:HTNPrimitiveTask
          operator: !type:JukeOperator
            jukeType: AdjacentTile
        - !type:HTNPrimitiveTask
          preconditions:
            - !type:KeyExistsPrecondition
              key: Target
          operator: !type:GunOperator
            targetKey: Target
          services:
            - !type:UtilityService
              id: RangedService
              proto: NearbyGunTargets
              key: Target

- type: htnCompound
  id: MeleeCombatCompoundBotStalkerZombie
  branches:
    # Pickup weapon if we don't have one.
    - preconditions:
        - !type:ActiveHandComponentPrecondition
          components:
            # Just serializer things
            - type: MeleeWeapon
              damage:
                types:
                  Brute: 0
          invert: true
      tasks:
        - !type:HTNCompoundTask
          task: PickupMeleeCompoundFix
    - tasks:
        - !type:HTNPrimitiveTask
          operator: !type:UtilityOperator
            proto: NearbyMeleeTargets
        - !type:HTNCompoundTask
          task: MeleeAttackTargetCompoundBotStalkerZombie

- type: htnCompound
  id: RangedCombatCompoundBotStalkerZombie
  branches:
    - preconditions:
        - !type:GunAmmoPrecondition
          minPercent: 0.001
      tasks:
        - !type:HTNCompoundTask
          task: GunCombatCompoundBotStalkerZombie
    -  preconditions:
         - !type:ActiveHandComponentPrecondition
           components:
             - type: Gun
           invert: true
       tasks:
         - !type:HTNCompoundTask
           task: PickupGunCompound
    - preconditions:
        - !type:ActiveHandComponentPrecondition
          components:
            - type: Gun
        - !type:GunAmmoPrecondition
          maxPercent: 0.001
      tasks:
        - !type:HTNPrimitiveTask
          preconditions:
            - !type:ActiveHandEntityPrecondition
          operator: !type:DropOperator

- type: autoEmote
  id: Screams
  emote: Scream
  interval: 270.0
  chance: 0.3
  withChat: true

- type: advertisementsPack
  id: SayStalkerZombie
  advertisements:
    - "Болит... Болит... Ай болит.... Ой болит, не надо болеть. Не надо..."
    - "Рейд. А мы скоро вернёмся. Не переживай, цветик, ладно?"
    - "Доча-доченька, дочь.Какая большая стала. Скоро папа вернётся"
    - "Дай паёк-жрать хочется. Охото жрать- дай паёк аа.."
    - "Зона. Зона-...... Все ровно выберусь, всё ровно"
    - "Скоро весна, тепло, как дома.."
    - "Найти артефакты, найти артефакты, найти артефакты...Побольше..."
    - "Ещё немного... И домой... Вот только найти дорогу..."
    - "Любит...Не любит...Любит...Не любит.."
    - "С-с-с-с-солдат, с-с-с-соооолдат!"
    - "М-м-м-м-маааааааам-м-м-маааааа..."
    - "Дооооч-ч-ченька, п-п-п-прасти меня..."
    - "С-с-с-сто... С-с-стоять!"
    - "К-к-кууууда?!"
    - "П-п-п-п... П-п-памагииит-т-те"
    - "З-з... З-з-зааааачто"
    - "Н-н-н... Не с-т-треаляй!"
    - "Жрать... Жрать... Ай жрать.... Ой жрать, не надо жрать. Не надо..."
    - "Рааа-аа-айд. Мы скоро вернёмся. Не переживай, человечишка, ладно?"
    - "Доча-доченька, дочь.Какая большая стала. Скоро папа вернётся... и съест."
    - "Дай мозгоооов... хочется. Охото мозги- дай мозги аа.."
    - "Тьма. Тьма-...... Все ровно найду мозги, всё ровно"
    - "Скоро весна, тепло, как в плоти.."
    - "Найти выживших, найти выживших, найти выживших... Побольше..."
    - "Ещё немного... И здесь найду дом... Вот только найти выход..."
    - "Че-е-е-еловек, че-е-еловек!"
    - "М-м-м-м-мозги-м-м-мозги!"
    - "Дооооч-ч-ченька, п-п-прости меня... прости, что съем."
    - "З-з... З-з-зааааачем"
    - "Н-н-н... Не с-т-трепетать!"
    - "Голод... Голод... Ай голод.... Ой голод, не надо голодать. Не надо..."
    - "Рейд... А мы скоро вернёмся... Не переживай, товарищ, ладно?"
    - "Мать-матушка, мать. Какая большая стала. Скоро папа вернётся..."
    - "Дай мяса-жрать хочется. Охото жрать- дай мяса аа.."
    - "Тьма. Тьма-...... Всё ровно выберусь, всё ровно"
    - "Скоро осень, холод, как в могиле.."
    - "Найти плоть, найти плоть, найти плоть... Побольше..."
    - "Ещё чуть-чуть... И возвращусь... Вот только найти дорогу..."
    - "Любит...Не любит...Хочет...Не хочет.."
    - "Т-т-т-тьма, т-т-тьма!"
    - "Че-е-еловек, че-е-еловек!"
    - "Пл-пл-пл... Пл-пл-плоть-т-т-те"
    - "Жрать... Жрать... Ай жрать.... Ой жрать, не надо жрать. Не надо..."
    - "Рааа-аа-айд. Мы скоро вернёмся. Не переживай, человечишка, ладно?"
    - "Доча-доченька, дочь.Какая большая стала. Скоро папа вернётся... и съест."
    - "Дай мозгоооов... хочется. Охото мозги- дай мозги аа.."
    - "Тьма. Тьма-...... Все ровно найду мозги, всё ровно"
    - "Скоро лето, жара..."
    - "Н-не... уби-в-ай н-н-не-е-т!"
    - "Доча-доченька... эээ... Какая большая стала... Скоро папа вернется..."
    - "а-ыыыы... Болит, болит... Ай, болит ыы-ыыы..."