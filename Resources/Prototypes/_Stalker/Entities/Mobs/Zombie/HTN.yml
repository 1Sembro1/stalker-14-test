- type: htnCompound
  id: BotStalkerZombie
  branches:
    - tasks:
        - !type:HTNCompoundTask
          task: RangedCombatCompoundBotStalkerZombie
    - tasks:
        - !type:HTNCompoundTask
          task: MeleeCombatCompoundBotStalkerZombie
    - tasks:
        - !type:HTNCompoundTask
          task: IdleCompoundBotStalkerZombie

- type: htnCompound
  id: IdleCompoundBotStalkerZombie
  branches:
    - tasks:
        - !type:HTNPrimitiveTask
          operator: !type:PickAccessibleOperator
            rangeKey: BufferRange
        - !type:HTNPrimitiveTask
          operator: !type:MoveToOperator
            pathfindInPlanning: false
        - !type:HTNPrimitiveTask
          operator: !type:RandomOperator
            targetKey: IdleTime
            minKey: MovementRangeClose
            maxKey: MinimumIdleTime
        - !type:HTNPrimitiveTask
          operator: !type:WaitOperator
            key: IdleTime
          preconditions:
            - !type:KeyExistsPrecondition
              key: IdleTime

- type: htnCompound
  id: PickupMeleeCompoundFix
  branches:
    - tasks:
        - !type:HTNPrimitiveTask
          operator: !type:UtilityOperator
            proto: NearbyMeleeWeapons
        - !type:HTNPrimitiveTask
          operator: !type:MoveToOperator
            pathfindInPlanning: true
        - !type:HTNPrimitiveTask
          preconditions:
            - !type:ActiveHandFreePrecondition
            - !type:TargetInRangePrecondition
              targetKey: Target
              rangeKey: InteractRange
          operator: !type:InteractWithOperator
            targetKey: Target


- type: htnCompound
  id: MeleeAttackTargetCompoundBotStalkerZombie
  preconditions:
    - !type:KeyExistsPrecondition
      key: Target
  branches:
    # Move to melee range and hit them
    - tasks:
        - !type:HTNPrimitiveTask
          operator: !type:MoveToOperator
            shutdownState: PlanFinished
            pathfindInPlanning: true
            removeKeyOnFinish: false
            targetKey: TargetCoordinates
            pathfindKey: TargetPathfind
            rangeKey: MeleeRange
        - !type:HTNPrimitiveTask
          operator: !type:JukeOperator
            jukeType: Away
        - !type:HTNPrimitiveTask
          operator: !type:MeleeOperator
            targetKey: Target
          preconditions:
            - !type:KeyExistsPrecondition
              key: Target
            - !type:TargetInRangePrecondition
              targetKey: Target
              rangeKey: MeleeRange
          services:
            - !type:UtilityService
              id: MeleeService
              proto: NearbyMeleeTargets
              key: Target

- type: htnCompound
  id: GunCombatCompoundBotStalkerZombie
  branches:
    # Pick target, then move into range and shoot them.
    - tasks:
        - !type:HTNPrimitiveTask
          operator: !type:UtilityOperator
            proto: NearbyGunTargets
        - !type:HTNPrimitiveTask
          operator: !type:MoveToOperator
            shutdownState: PlanFinished
            pathfindInPlanning: true
            removeKeyOnFinish: false
            targetKey: TargetCoordinates
            pathfindKey: TargetPathfind
            stopOnLineOfSight: true
            rangeKey: MeleeRange
        - !type:HTNPrimitiveTask
          operator: !type:JukeOperator
            jukeType: AdjacentTile
        - !type:HTNPrimitiveTask
          preconditions:
            - !type:KeyExistsPrecondition
              key: Target
          operator: !type:GunOperator
            targetKey: Target
          services:
            - !type:UtilityService
              id: RangedService
              proto: NearbyGunTargets
              key: Target

- type: htnCompound
  id: MeleeCombatCompoundBotStalkerZombie
  branches:
    # Pickup weapon if we don't have one.
    - preconditions:
        - !type:ActiveHandComponentPrecondition
          components:
            # Just serializer things
            - type: MeleeWeapon
              damage:
                types:
                  Brute: 0
          invert: true
      tasks:
        - !type:HTNCompoundTask
          task: PickupMeleeCompoundFix
    - tasks:
        - !type:HTNPrimitiveTask
          operator: !type:UtilityOperator
            proto: NearbyMeleeTargets
        - !type:HTNCompoundTask
          task: MeleeAttackTargetCompoundBotStalkerZombie

- type: htnCompound
  id: RangedCombatCompoundBotStalkerZombie
  branches:
    - preconditions:
        - !type:GunAmmoPrecondition
          minPercent: 0.001
      tasks:
        - !type:HTNCompoundTask
          task: GunCombatCompoundBotStalkerZombie
    -  preconditions:
         - !type:ActiveHandComponentPrecondition
           components:
             - type: Gun
           invert: true
       tasks:
         - !type:HTNCompoundTask
           task: PickupGunCompound
    - preconditions:
        - !type:ActiveHandComponentPrecondition
          components:
            - type: Gun
        - !type:GunAmmoPrecondition
          maxPercent: 0.001
      tasks:
        - !type:HTNPrimitiveTask
          preconditions:
            - !type:ActiveHandEntityPrecondition
          operator: !type:DropOperator

- type: autoEmote
  id: Screams
  emote: Scream
  interval: 270.0
  chance: 0.3
  withChat: true
